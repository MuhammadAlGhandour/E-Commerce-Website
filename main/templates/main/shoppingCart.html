{% extends "main/index.html" %} {% block content %} {% load static %}
{% load custom_filters %}
    
<link rel="stylesheet" href="{% static 'main/cart_style.css' %}">
    <script>
      // scripts.js

      document.addEventListener("DOMContentLoaded", function () {
        // Update subtotal and total when quantity changes
        document
          .querySelectorAll('#cart-table input[type="number"]')
          .forEach((input) => {
            input.addEventListener("change", updateCart);
          });

        // Remove item from cart
        document.querySelectorAll(".remove").forEach((button) => {
          button.addEventListener("click", function () {
            const row = this.closest("tr");
            row.remove();
            updateCart();
          });
        });

        // Function to update the cart
        function updateCart() {
          let total = 0;
          document.querySelectorAll("#cart-table tbody tr").forEach((row) => {
            const quantity = row.querySelector('input[type="number"]').value;
            const price = parseFloat(row.cells[2].textContent.replace("$", ""));
            const subtotal = quantity * price;
            row.cells[3].textContent = `$${subtotal.toFixed(2)}`;
            total += subtotal;
          });
          document.querySelector(
            ".cart-total h3"
          ).textContent = `Total: $${total.toFixed(2)}`;
        }
      });
    </script>



    <section id="cart">
      <h2>Your Shopping Cart</h2>
      <table id="cart-table">
        <thead>
          <tr>
            <th>Product</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Subtotal</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <!--if products exist-->
          {% if products %}
          <!--for loop-->
          {% for product in products %}
          <tr>
            <td>{{product.product.product_name}}</td>
            <td>
              <input type="number" value="{{product.quantity}}" min="1" />
            </td>
            <td>${{product.product.price}}</td>
            <td>${{product.subtotal_price}}</td>
            <td><a href="{% url 'remove' product.id %}"><button class="remove">Remove</button></a></td>
          </tr>
          <!--endfor-->
          {% endfor %}
          <!--if not-->
          {% else %}
          <!--the cart is empty-->
          <h3>There's no products in the cart</h3>
          <!--endif-->
          {% endif %}
        </tbody>
      </table>
      <div class="cart-total">
        <h3>Total: $0</h3>
        
        {% if not products %}
        <button id="checkout" hidden disabled>Proceed to Checkout</button>
        {% else %}
        <button id="checkout" >Proceed to Checkout</button>
        {% endif %}
      </div>
    </section>

{% endblock content %}